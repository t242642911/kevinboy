<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>玩家心跳軌跡分析 - 高端版</title>
    <style>
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #6b88ff;
            --accent-color: #7a77ff;
            --dark-bg: #1a1f2c;
            --darker-bg: #151a25;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-hover-bg: rgba(255, 255, 255, 0.1);
            --card-active-bg: rgba(255, 107, 107, 0.15);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --phase1-color: #66c2ff;
            --phase2-color: #7a77ff;
            --phase3-color: #ff6b6b;
            --phase4-color: #66bb6a;
            --tooltip-bg: rgba(30, 36, 50, 0.95);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Helvetica Neue', Arial, 'PingFang TC', 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        .dashboard {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* 头部区域 */
        .header {
            text-align: center;
            padding: 20px 0 30px;
            position: relative;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #ff6b6b, #ffb88c, #7a77ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 1px;
            text-shadow: 0 2px 10px rgba(255, 107, 107, 0.2);
            position: relative;
        }

        .header h1 svg {
            margin-right: 15px;
            filter: drop-shadow(0 0 8px rgba(255, 107, 107, 0.6));
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        .header p {
            font-size: 16px;
            color: var(--secondary-color);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
            letter-spacing: 0.5px;
        }

        .divider {
            margin: 10px 0 30px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--primary-color));
            border-radius: 3px;
            position: relative;
            overflow: hidden;
        }

        .divider::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            100% { left: 200%; }
        }

        /* 选择剧本区域 */
        .script-selector {
            background-color: var(--darker-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .selector-header {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .selector-header h3 {
            font-size: 18px;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .selector-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .script-option {
            display: flex;
            align-items: center;
            gap: 12px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
            max-width: 300px;
        }
        
        .script-option:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }
        
        .script-option.active {
            background-color: rgba(255, 107, 107, 0.15);
            border-left: 3px solid var(--primary-color);
        }
        
        .option-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
        }
        
        .option-details {
            flex: 1;
        }
        
        .option-name {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 3px;
        }
        
        .option-type {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* 心率图表区域 */
        .heart-rate-container {
            background-color: var(--darker-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 500;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
        }

        .legend {
            display: flex;
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        .btn {
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 6px;
            color: var(--text-primary);
            padding: 6px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .btn svg {
            width: 16px;
            height: 16px;
        }

        .heart-rate-graph {
            width: 100%;
            height: 300px;
            position: relative;
            margin-top: 10px;
        }

        .y-axis {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 50px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px 0;
            z-index: 1;
        }

        .y-axis-label {
            font-size: 12px;
            color: var(--text-secondary);
            position: relative;
        }

        .y-axis-label::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 30px;
            width: calc(100vw - 100px);
            height: 1px;
            background-color: rgba(255, 255, 255, 0.05);
            z-index: -1;
        }

        .x-axis {
            position: absolute;
            bottom: 10px;
            left: 50px;
            right: 10px;
            display: flex;
            justify-content: space-between;
        }

        .x-axis-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
            width: 30px;
        }

        .graph-container {
            position: absolute;
            top: 0;
            left: 50px;
            right: 10px;
            bottom: 30px;
            overflow: hidden;
        }

        .graph-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                rgba(102, 194, 255, 0.05) 0%, 
                rgba(102, 194, 255, 0.05) 10%, 
                rgba(122, 119, 255, 0.05) 10%, 
                rgba(122, 119, 255, 0.05) 50%,
                rgba(255, 107, 107, 0.05) 50%, 
                rgba(255, 107, 107, 0.05) 80%, 
                rgba(102, 187, 106, 0.05) 80%, 
                rgba(102, 187, 106, 0.05) 100%);
            pointer-events: none;
        }

        .phase-markers {
            position: absolute;
            top: 10px;
            left: 50px;
            right: 10px;
            height: 20px;
            display: flex;
        }

        .phase-marker {
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .phase-marker-label {
            position: absolute;
            top: -25px;
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 10px;
            white-space: nowrap;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
            color: #fff;
        }

        .phase-marker:hover .phase-marker-label {
            opacity: 1;
            transform: translateY(0);
        }

        .phase-marker-line {
            width: 1px;
            height: 200%;
            background-color: rgba(255, 255, 255, 0.2);
            position: absolute;
            top: 100%;
            transition: background-color 0.3s ease;
        }

        .phase-marker:hover .phase-marker-line {
            background-color: rgba(255, 255, 255, 0.5);
        }

        .chart-time-indicator {
            position: absolute;
            top: 50px;
            left: 0;
            width: 2px;
            height: calc(100% - 80px);
            background-color: rgba(255, 255, 255, 0.7);
            z-index: 5;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .time-indicator-handle {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: white;
            position: absolute;
            top: -5px;
            left: -4px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }

        .time-indicator-label {
            position: absolute;
            top: -30px;
            background-color: var(--tooltip-bg);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            transform: translateX(-50%);
        }

        .stats-indicators {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 10;
        }

        .stat-indicator {
            background-color: var(--tooltip-bg);
            border-radius: 8px;
            padding: 10px 15px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-left: 3px solid var(--primary-color);
            min-width: 150px;
            position: relative;
            overflow: hidden;
        }

        .stat-indicator::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), transparent);
        }

        .current-phase {
            border-left-color: var(--phase3-color);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .bpm-value {
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.3);
            animation: pulse 1.5s infinite alternate;
        }

        .phase-value {
            color: var(--phase3-color);
        }

        @keyframes pulse {
            0% { text-shadow: 0 0 5px rgba(255, 107, 107, 0.3); }
            100% { text-shadow: 0 0 15px rgba(255, 107, 107, 0.6); }
        }

        .data-point-tooltip {
            position: absolute;
            background-color: var(--tooltip-bg);
            border-radius: 6px;
            padding: 10px;
            font-size: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 100;
            max-width: 200px;
        }

        .tooltip-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        .tooltip-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
        }

        .tooltip-label {
            color: var(--text-secondary);
        }

        .tooltip-value {
            font-weight: 500;
        }

        /* 阶段卡片区域 */
        .phases-section {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .phase-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            min-height: 280px;
            display: flex;
            flex-direction: column;
        }

        .phase-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--phase1-color);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .phase-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            background-color: var(--card-hover-bg);
        }

        .phase-card:hover::before {
            transform: scaleX(1);
        }

        .phase-card.active {
            background-color: rgba(73, 46, 60, 0.5);
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.2);
        }

        .phase-card.active::before {
            transform: scaleX(1);
            height: 4px;
        }

        .phase-card[data-phase="1"]::before { background: var(--phase1-color); }
        .phase-card[data-phase="2"]::before { background: var(--phase2-color); }
        .phase-card[data-phase="3"]::before { background: var(--phase3-color); }
        .phase-card[data-phase="4"]::before { background: var(--phase4-color); }

        .phase-card-header {
            margin-bottom: 15px;
        }

        .phase-card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
            transition: color 0.3s ease;
        }

        .phase-card[data-phase="1"] .phase-card-title { color: var(--phase1-color); }
        .phase-card[data-phase="2"] .phase-card-title { color: var(--phase2-color); }
        .phase-card[data-phase="3"] .phase-card-title { color: var(--phase3-color); }
        .phase-card[data-phase="4"] .phase-card-title { color: var(--phase4-color); }

        .phase-emotion {
            font-size: 14px;
            margin-bottom: 12px;
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .phase-card[data-phase="1"] .phase-emotion { color: var(--phase1-color); }
        .phase-card[data-phase="2"] .phase-emotion { color: var(--phase2-color); }
        .phase-card[data-phase="3"] .phase-emotion { color: var(--phase3-color); }
        .phase-card[data-phase="4"] .phase-emotion { color: var(--phase4-color); }

        .phase-description {
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: 15px;
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px;
        }

        .phase-description::-webkit-scrollbar {
            width: 4px;
        }

        .phase-description::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }

        .phase-time {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-secondary);
            padding: 5px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .phase-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            gap: 10px;
        }

        .phase-stat {
            flex: 1;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 8px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-number {
            font-size: 18px;
            font-weight: 600;
        }

        .phase-card[data-phase="1"] .stat-number { color: var(--phase1-color); }
        .phase-card[data-phase="2"] .stat-number { color: var(--phase2-color); }
        .phase-card[data-phase="3"] .stat-number { color: var(--phase3-color); }
        .phase-card[data-phase="4"] .stat-number { color: var(--phase4-color); }

        .stat-name {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 3px;
        }

        /* 响应式设计 */
        @media (max-width: 1200px) {
            .phases-section {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .settings-panel {
                width: 100%;
                right: -100%;
            }
            
            .stats-indicators {
                position: static;
                margin-bottom: 20px;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: space-between;
            }
            
            .stat-indicator {
                min-width: auto;
                flex: 1;
            }

            .selector-container {
                flex-direction: column;
            }
        }

        @media (max-width: 576px) {
            .phases-section {
                grid-template-columns: 1fr;
            }
            
            .chart-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .legend {
                flex-wrap: wrap;
            }
        }

        /* 动画效果 */
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-up {
            animation: slideUp 0.5s ease forwards;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .rotate-in {
            animation: rotateIn 0.5s ease forwards;
        }

        @keyframes rotateIn {
            from { opacity: 0; transform: rotate(-10deg) scale(0.9); }
            to { opacity: 1; transform: rotate(0) scale(1); }
        }

        /* 覆盖层 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .overlay.open {
            opacity: 1;
            pointer-events: auto;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header fade-in">
            <h1>
                <svg width="32" height="32" viewBox="0 0 24 24" fill="#ff6b6b">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
                玩家心跳軌跡分析
            </h1>
            <p>即時反映遊戲過程中的情緒波動與沉浸程度，幫助設計師優化劇本體驗</p>
        </div>
        
        <div class="divider"></div>
        
        <!-- 剧本选择部分 -->
        <div class="script-selector fade-in">
            <div class="selector-header">
                <h3>選擇劇本查看心跳軌跡</h3>
            </div>
            <div class="selector-container">
                <div class="script-option active" data-script="script1">
                    <div class="option-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2"></path>
                            <path d="M20 8v12a2 2 0 0 1-2 2H6"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </div>
                    <div class="option-details">
                        <div class="option-name">《暗夜追凶》</div>
                        <div class="option-type">偵探懸疑</div>
                    </div>
                </div>
                <div class="script-option" data-script="script2">
                    <div class="option-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4v16h16"></path>
                            <path d="M4 20l7-7"></path>
                            <path d="M15 9l2-2"></path>
                            <path d="M9 15l4 4"></path>
                            <path d="M13 11l6-6"></path>
                        </svg>
                    </div>
                    <div class="option-details">
                        <div class="option-name">《死亡派對》</div>
                        <div class="option-type">恐怖驚悚</div>
                    </div>
                </div>
                <div class="script-option" data-script="script3">
                    <div class="option-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                        </svg>
                    </div>
                    <div class="option-details">
                        <div class="option-name">《記憶碎片》</div>
                        <div class="option-type">心理懸疑</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="heart-rate-container slide-up">
            <div class="chart-header">
                <div class="chart-title">
                    心率變化趨勢
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--phase1-color);"></div>
                        <span>開始階段</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--phase2-color);"></div>
                        <span>探索階段</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--phase3-color);"></div>
                        <span>高潮階段</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: var(--phase4-color);"></div>
                        <span>結局階段</span>
                    </div>
                </div>
                <div class="controls">
                    <button class="btn" id="exportBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="7 10 12 15 17 10" />
                            <line x1="12" y1="15" x2="12" y2="3" />
                        </svg>
                        導出數據
                    </button>
                </div>
            </div>
            
            <div class="heart-rate-graph">
                <div class="y-axis">
                    <div class="y-axis-label">120 BPM</div>
                    <div class="y-axis-label">100 BPM</div>
                    <div class="y-axis-label">80 BPM</div>
                    <div class="y-axis-label">60 BPM</div>
                    <div class="y-axis-label">50 BPM</div>
                </div>
                
                <div class="x-axis">
                    <div class="x-axis-label">0分</div>
                    <div class="x-axis-label">5分</div>
                    <div class="x-axis-label">10分</div>
                    <div class="x-axis-label">15分</div>
                    <div class="x-axis-label">20分</div>
                    <div class="x-axis-label">25分</div>
                    <div class="x-axis-label">30分</div>
                    <div class="x-axis-label">35分</div>
                    <div class="x-axis-label">40分</div>
                    <div class="x-axis-label">45分</div>
                    <div class="x-axis-label">50分</div>
                </div>
                
                <div class="graph-container">
                    <div class="graph-overlay"></div>
                    <svg id="heartRateGraph" width="100%" height="100%" preserveAspectRatio="none" viewBox="0 0 1000 200">
                        <!-- 背景线条 -->
                        <line x1="0" y1="40" x2="1000" y2="40" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                        <line x1="0" y1="80" x2="1000" y2="80" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                        <line x1="0" y1="120" x2="1000" y2="120" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                        <line x1="0" y1="160" x2="1000" y2="160" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                        
                        <!-- 心率线 -->
                        <path id="heartRatePath" d="M0,140 C10,138 20,142 30,140 S40,136 50,138 S60,144 70,140 S80,135 90,138 S100,145 110,140 S120,135 130,138 S140,144 150,142 S160,138 170,140 S180,144 190,140 S200,135 210,138 S220,145 230,140 S240,135 250,138 S260,144 270,140 S280,138 290,140 S300,144 310,140 S320,135 330,138 S340,145 350,140 S360,135 370,138 S380,144 390,140 S400,138 410,140 S420,144 430,140 S440,135 450,138 S460,145 470,140 S480,135 490,140 S500,144 510,90 S520,85 530,88 S540,95 550,90 S560,85 570,88 S580,94 590,90 S600,86 610,90 S620,94 630,90 S640,85 650,88 S660,95 670,90 S680,85 690,88 S700,94 710,90 S720,86 730,90 S740,94 750,90 S760,85 770,88 S780,95 790,90 S800,85 810,88 S820,94 830,90 S840,86 850,90 S860,94 870,90 S880,85 890,88 S900,95 910,90 S920,85 930,88 S940,94 950,90 S960,86 970,90 S980,94 990,90 S1000,88 1000,88" 
                             fill="none" stroke="#ff6b6b" stroke-width="2.5">
                            <animate attributeName="d" 
                                    dur="8s" 
                                    repeatCount="indefinite" 
                                    values="M0,140 C10,138 20,142 30,140 S40,136 50,138 S60,144 70,140 S80,135 90,138 S100,145 110,140 S120,135 130,138 S140,144 150,142 S160,138 170,140 S180,144 190,140 S200,135 210,138 S220,145 230,140 S240,135 250,138 S260,144 270,140 S280,138 290,140 S300,144 310,140 S320,135 330,138 S340,145 350,140 S360,135 370,138 S380,144 390,140 S400,138 410,140 S420,144 430,140 S440,135 450,138 S460,145 470,140 S480,135 490,140 S500,144 510,90 S520,85 530,88 S540,95 550,90 S560,85 570,88 S580,94 590,90 S600,86 610,90 S620,94 630,90 S640,85 650,88 S660,95 670,90 S680,85 690,88 S700,94 710,90 S720,86 730,90 S740,94 750,90 S760,85 770,88 S780,95 790,90 S800,85 810,88 S820,94 830,90 S840,86 850,90 S860,94 870,90 S880,85 890,88 S900,95 910,90 S920,85 930,88 S940,94 950,90 S960,86 970,90 S980,94 990,90 S1000,88 1000,88;
                                        M0,142 C10,140 20,144 30,142 S40,138 50,140 S60,146 70,142 S80,137 90,140 S100,147 110,142 S120,137 130,140 S140,146 150,144 S160,140 170,142 S180,146 190,142 S200,137 210,140 S220,147 230,142 S240,137 250,140 S260,146 270,142 S280,140 290,142 S300,146 310,142 S320,137 330,140 S340,147 350,142 S360,137 370,140 S380,146 390,142 S400,140 410,142 S420,146 430,142 S440,137 450,140 S460,147 470,142 S480,137 490,142 S500,146 510,88 S520,83 530,86 S540,93 550,88 S560,83 570,86 S580,92 590,88 S600,84 610,88 S620,92 630,88 S640,83 650,86 S660,93 670,88 S680,83 690,86 S700,92 710,88 S720,84 730,88 S740,92 750,88 S760,83 770,86 S780,93 790,88 S800,83 810,86 S820,92 830,88 S840,84 850,88 S860,92 870,88 S880,83 890,86 S900,93 910,88 S920,83 930,86 S940,92 950,88 S960,84 970,88 S980,92 990,88 S1000,86 1000,86;
                                        M0,138 C10,135 20,140 30,138 S40,134 50,136 S60,142 70,138 S80,133 90,136 S100,143 110,138 S120,133 130,136 S140,142 150,140 S160,136 170,138 S180,142 190,138 S200,133 210,136 S220,143 230,138 S240,133 250,136 S260,142 270,138 S280,136 290,138 S300,142 310,138 S320,133 330,136 S340,143 350,138 S360,133 370,136 S380,142 390,138 S400,136 410,138 S420,142 430,138 S440,133 450,136 S460,143 470,138 S480,133 490,138 S500,142 510,92 S520,87 530,90 S540,97 550,92 S560,87 570,90 S580,96 590,92 S600,88 610,92 S620,96 630,92 S640,87 650,90 S660,97 670,92 S680,87 690,90 S700,96 710,92 S720,88 730,92 S740,96 750,92 S760,87 770,90 S780,97 790,92 S800,87 810,90 S820,96 830,92 S840,88 850,92 S860,96 870,92 S880,87 890,90 S900,97 910,92 S920,87 930,90 S940,96 950,92 S960,88 970,92 S980,96 990,92 S1000,90 1000,90"
                            />
                        </path>
                        
                        <!-- 数据点 -->
                        <g id="dataPoints"></g>
                        
                        <!-- 阶段分隔线 -->
                        <line x1="100" y1="0" x2="100" y2="200" stroke="rgba(102, 194, 255, 0.3)" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="500" y1="0" x2="500" y2="200" stroke="rgba(255, 107, 107, 0.3)" stroke-width="1" stroke-dasharray="5,5"/>
                        <line x1="800" y1="0" x2="800" y2="200" stroke="rgba(102, 187, 106, 0.3)" stroke-width="1" stroke-dasharray="5,5"/>
                    </svg>
                </div>
                
                <div class="phase-markers">
                    <div class="phase-marker" style="width: 10%; left: 0%;">
                        <div class="phase-marker-label" style="background-color: var(--phase1-color);">開始階段</div>
                        <div class="phase-marker-line"></div>
                    </div>
                    <div class="phase-marker" style="width: 40%; left: 10%;">
                        <div class="phase-marker-label" style="background-color: var(--phase2-color);">探索階段</div>
                        <div class="phase-marker-line"></div>
                    </div>
                    <div class="phase-marker" style="width: 30%; left: 50%;">
                        <div class="phase-marker-label" style="background-color: var(--phase3-color);">高潮階段</div>
                        <div class="phase-marker-line"></div>
                    </div>
                    <div class="phase-marker" style="width: 20%; left: 80%;">
                        <div class="phase-marker-label" style="background-color: var(--phase4-color);">結局階段</div>
                        <div class="phase-marker-line"></div>
                    </div>
                </div>
                
                <div class="chart-time-indicator" id="timeIndicator" style="left: 50%;">
                    <div class="time-indicator-handle"></div>
                    <div class="time-indicator-label">25分 - 82 BPM</div>
                </div>
                
                <div class="stats-indicators">
                    <div class="stat-indicator">
                        <div class="stat-label">當前心率</div>
                        <div class="stat-value bpm-value" id="bpmValue">82 BPM</div>
                    </div>
                    <div class="stat-indicator current-phase">
                        <div class="stat-label">當前階段</div>
                        <div class="stat-value phase-value" id="phaseValue">高潮階段</div>
                    </div>
                </div>
                
                <div class="data-point-tooltip" id="dataTooltip">
                    <div class="tooltip-title">25分鐘</div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">心率:</span>
                        <span class="tooltip-value">82 BPM</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">波動強度:</span>
                        <span class="tooltip-value">高</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">情緒狀態:</span>
                        <span class="tooltip-value">緊張/興奮</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="phases-section rotate-in">
            <div class="phase-card active" data-phase="1" id="phase1">
                <div class="phase-card-header">
                    <h3 class="phase-card-title">開始階段</h3>
                    <div class="phase-emotion">好奇/期待</div>
                </div>
                <div class="phase-description">
                    玩家初次接觸劇本，對故事背景和角色產生興趣。心率處於基礎水平，偶有微小波動。
                </div>
                <div class="phase-stats">
                    <div class="phase-stat">
                        <div class="stat-number">62</div>
                        <div class="stat-name">平均BPM</div>
                    </div>
                    <div class="phase-stat">
                        <div class="stat-number">5%</div>
                        <div class="stat-name">波動率</div>
                    </div>
                </div>
                <div class="phase-time">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    0-5分鐘
                </div>
            </div>
            
            <div class="phase-card" data-phase="2" id="phase2">
                <div class="phase-card-header">
                    <h3 class="phase-card-title">探索階段</h3>
                    <div class="phase-emotion">思考/分析</div>
                </div>
                <div class="phase-description">
                    玩家深入劇情，開始收集線索並分析信息。心率略有上升但保持相對穩定，表示專注和思考。
                </div>
                <div class="phase-stats">
                    <div class="phase-stat">
                        <div class="stat-number">68</div>
                        <div class="stat-name">平均BPM</div>
                    </div>
                    <div class="phase-stat">
                        <div class="stat-number">8%</div>
                        <div class="stat-name">波動率</div>
                    </div>
                </div>
                <div class="phase-time">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    5-25分鐘
                </div>
            </div>
            
            <div class="phase-card" data-phase="3" id="phase3">
                <div class="phase-card-header">
                    <h3 class="phase-card-title">高潮階段</h3>
                    <div class="phase-emotion">緊張/興奮</div>
                </div>
                <div class="phase-description">
                    關鍵信息揭露，劇情轉折或衝突出現。心率明顯上升，波動幅度變大，反映玩家情緒高漲。
                </div>
                <div class="phase-stats">
                    <div class="phase-stat">
                        <div class="stat-number">85</div>
                        <div class="stat-name">平均BPM</div>
                    </div>
                    <div class="phase-stat">
                        <div class="stat-number">18%</div>
                        <div class="stat-name">波動率</div>
                    </div>
                </div>
                <div class="phase-time">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    25-40分鐘
                </div>
            </div>
            
            <div class="phase-card" data-phase="4" id="phase4">
                <div class="phase-card-header">
                    <h3 class="phase-card-title">結局階段</h3>
                    <div class="phase-emotion">釋然/回味</div>
                </div>
                <div class="phase-description">
                    謎底揭曉，故事收束。心率逐漸回落並趨於穩定，表示壓力釋放和情緒沉澱。
                </div>
                <div class="phase-stats">
                    <div class="phase-stat">
                        <div class="stat-number">72</div>
                        <div class="stat-name">平均BPM</div>
                    </div>
                    <div class="phase-stat">
                        <div class="stat-number">7%</div>
                        <div class="stat-name">波動率</div>
                    </div>
                </div>
                <div class="phase-time">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    40-50分鐘
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 選擇剧本功能
            const scriptOptions = document.querySelectorAll('.script-option');
            const heartRatePath = document.getElementById('heartRatePath');
            const bpmValue = document.getElementById('bpmValue');
            const phaseValue = document.getElementById('phaseValue');
            const timeIndicator = document.getElementById('timeIndicator');
            const phaseCards = document.querySelectorAll('.phase-card');
            
            // 各劇本的心率曲線數據
            const scriptData = {
                script1: { // 暗夜追凶 - 後期高峰
                    pathData: "M0,140 C10,138 20,142 30,140 S40,136 50,138 S60,144 70,140 S80,135 90,138 S100,145 110,140 S120,135 130,138 S140,144 150,142 S160,138 170,140 S180,144 190,140 S200,135 210,138 S220,145 230,140 S240,135 250,138 S260,144 270,140 S280,138 290,140 S300,144 310,140 S320,135 330,138 S340,145 350,140 S360,135 370,138 S380,144 390,140 S400,138 410,140 S420,144 430,140 S440,135 450,138 S460,145 470,140 S480,135 490,140 S500,144 510,90 S520,85 530,88 S540,95 550,90 S560,85 570,88 S580,94 590,90 S600,86 610,90 S620,94 630,90 S640,85 650,88 S660,95 670,90 S680,85 690,88 S700,94 710,90 S720,86 730,90 S740,94 750,90 S760,85 770,88 S780,95 790,90 S800,85 810,88 S820,94 830,90 S840,86 850,90 S860,94 870,90 S880,85 890,88 S900,95 910,90 S920,85 930,88 S940,94 950,90 S960,86 970,90 S980,94 990,90 S1000,88 1000,88",
                    bpm: 82,
                    phase: "高潮階段",
                    indicatorPosition: "50%"
                },
                script2: { // 死亡派對 - 前期爆發
                    pathData: "M0,90 C10,88 20,85 30,90 S40,95 50,90 S60,85 70,88 S80,94 90,90 S100,86 110,90 S120,95 130,90 S140,85 150,87 S160,90 170,92 S180,95 190,100 S200,110 210,120 S220,125 230,130 S240,132 250,130 S260,128 270,130 S280,135 290,138 S300,140 310,142 S320,140 330,138 S340,135 350,138 S360,142 370,145 S380,142 390,140 S400,138 410,140 S420,144 430,140 S440,135 450,138 S460,145 470,140 S480,135 490,140 S500,144 510,142 S520,138 530,140 S540,144 550,140 S560,135 570,138 S580,142 590,145 S600,142 610,140 S620,138 630,140 S640,144 650,140 S660,135 670,138 S680,142 690,145 S700,142 710,140 S720,138 730,140 S740,144 750,140 S760,135 770,138 S780,142 790,145 S800,142 810,140 S820,138 830,140 S840,144 850,140 S860,135 870,138 S880,142 890,145 S900,142 910,140 S920,138 930,140 S940,144 950,140 S960,135 970,138 S980,142 990,145 S1000,142 1000,142",
                    bpm: 92,
                    phase: "開始階段",
                    indicatorPosition: "5%"
                },
                script3: { // 記憶碎片 - 多峰波浪
                    pathData: "M0,140 C10,138 20,142 30,140 S40,136 50,90 S60,85 70,90 S80,120 90,138 S100,145 110,140 S120,90 130,88 S140,90 150,142 S160,138 170,140 S180,144 190,90 S200,85 210,88 S220,125 230,140 S240,135 250,90 S260,85 270,88 S280,120 290,140 S300,144 310,140 S320,90 330,88 S340,92 350,140 S360,135 370,138 S380,144 390,90 S400,85 410,90 S420,100 430,140 S440,135 450,138 S460,145 470,90 S480,85 490,90 S500,120 510,142 S520,138 530,90 S540,95 550,90 S560,100 570,138 S580,140 590,140 S600,138 610,90 S620,94 630,90 S640,95 650,138 S660,145 670,140 S680,90 690,88 S700,94 710,90 S720,95 730,138 S740,144 750,140 S760,90 770,88 S780,95 790,90 S800,105 810,138 S820,144 830,140 S840,90 850,88 S860,95 870,90 S880,125 890,138 S900,145 910,140 S920,90 930,88 S940,94 950,90 S960,105 970,138 S980,144 990,140 S1000,88 1000,88",
                    bpm: 88,
                    phase: "探索階段",
                    indicatorPosition: "30%"
                }
            };
            
            // 選擇劇本的事件處理
            scriptOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // 移除所有活躍狀態
                    scriptOptions.forEach(opt => opt.classList.remove('active'));
                    
                    // 設置當前選中劇本
                    this.classList.add('active');
                    const scriptId = this.getAttribute('data-script');
                    
                    // 更新心率圖和資訊
                    if (scriptData[scriptId]) {
                        const data = scriptData[scriptId];
                        
                        // 更新心率曲線
                        heartRatePath.setAttribute('d', data.pathData);
                        
                        // 移除舊的animate標籤（如果有）
                        const oldAnimate = heartRatePath.querySelector('animate');
                        if (oldAnimate) {
                            heartRatePath.removeChild(oldAnimate);
                        }
                        
                        // 添加新的動畫效果
                        const animate = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
                        animate.setAttribute('attributeName', 'd');
                        animate.setAttribute('dur', '8s');
                        animate.setAttribute('repeatCount', 'indefinite');
                        
                        // 生成動畫曲線的微小變化
                        const basePath = data.pathData;
                        const variation1 = basePath.replace(/S(\d+),(\d+)/g, function(match, p1, p2) {
                            return 'S' + p1 + ',' + (parseInt(p2) + Math.floor(Math.random() * 5) - 2);
                        });
                        
                        const variation2 = basePath.replace(/S(\d+),(\d+)/g, function(match, p1, p2) {
                            return 'S' + p1 + ',' + (parseInt(p2) + Math.floor(Math.random() * 5) - 2);
                        });
                        
                        animate.setAttribute('values', basePath + ';' + variation1 + ';' + variation2);
                        heartRatePath.appendChild(animate);
                        
                        // 更新BPM和階段信息
                        bpmValue.textContent = data.bpm + ' BPM';
                        phaseValue.textContent = data.phase;
                        
                        // 更新時間指示器位置
                        timeIndicator.style.left = data.indicatorPosition;
                        
                        // 更新當前階段卡片激活狀態
                        phaseCards.forEach(card => card.classList.remove('active'));
                        
                        if (data.phase === "開始階段") {
                            document.getElementById('phase1').classList.add('active');
                        } else if (data.phase === "探索階段") {
                            document.getElementById('phase2').classList.add('active');
                        } else if (data.phase === "高潮階段") {
                            document.getElementById('phase3').classList.add('active');
                        } else {
                            document.getElementById('phase4').classList.add('active');
                        }
                    }
                    
                    // 視覺反饋
                    this.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 300);
                });
            });
            
            // 階段卡片互動
            phaseCards.forEach(card => {
                card.addEventListener('click', function() {
                    // 移除所有活躍狀態
                    phaseCards.forEach(c => c.classList.remove('active'));
                    
                    // 設置當前選中階段
                    this.classList.add('active');
                });
            });
            
            // 初始化資料點
            initDataPoints();
            
            // 初始化数据点
            function initDataPoints() {
                const dataPoints = document.getElementById('dataPoints');
                const pointCount = 20;
                
                for (let i = 0; i < pointCount; i++) {
                    const x = (i / (pointCount - 1)) * 1000;
                    let y;
                    
                    if (x < 100) { // 開始階段
                        y = 140 - Math.random() * 10;
                    } else if (x < 500) { // 探索階段
                        y = 140 - Math.random() * 15;
                    } else if (x < 800) { // 高潮階段
                        y = 90 - Math.random() * 15;
                    } else { // 結局階段
                        y = 110 - Math.random() * 15;
                    }
                    
                    const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    circle.setAttribute("cx", x);
                    circle.setAttribute("cy", y);
                    circle.setAttribute("r", "5");
                    circle.setAttribute("fill", "rgba(255, 255, 255, 0.7)");
                    circle.setAttribute("stroke", "#ff6b6b");
                    circle.setAttribute("stroke-width", "1.5");
                    circle.setAttribute("class", "data-point");
                    circle.setAttribute("data-minute", Math.floor((i / (pointCount - 1)) * 50));
                    circle.setAttribute("data-bpm", Math.round((200 - y) * 0.7));
                    
                    dataPoints.appendChild(circle);
                    
                    // 添加鼠標事件
                    circle.addEventListener('mouseover', function(e) {
                        const minute = this.getAttribute('data-minute');
                        const bpm = this.getAttribute('data-bpm');
                        const dataTooltip = document.getElementById('dataTooltip');
                        
                        dataTooltip.querySelector('.tooltip-title').textContent = `${minute}分鐘`;
                        dataTooltip.querySelectorAll('.tooltip-value')[0].textContent = `${bpm} BPM`;
                        
                        // 設置波動強度和情緒狀態
                        let intensity, emotion;
                        if (minute < 5) {
                            intensity = '低';
                            emotion = '好奇/期待';
                        } else if (minute < 25) {
                            intensity = '中';
                            emotion = '思考/分析';
                        } else if (minute < 40) {
                            intensity = '高';
                            emotion = '緊張/興奮';
                        } else {
                            intensity = '中低';
                            emotion = '釋然/回味';
                        }
                        
                        dataTooltip.querySelectorAll('.tooltip-value')[1].textContent = intensity;
                        dataTooltip.querySelectorAll('.tooltip-value')[2].textContent = emotion;
                        
                        // 顯示提示框並定位
                        dataTooltip.style.opacity = '1';
                        const graph = document.querySelector('.heart-rate-graph');
                        dataTooltip.style.left = (e.pageX - graph.getBoundingClientRect().left) + 'px';
                        dataTooltip.style.top = (e.pageY - graph.getBoundingClientRect().top - 80) + 'px';
                        
                        // 放大數據點
                        this.setAttribute("r", "7");
                        this.setAttribute("fill", "#ff6b6b");
                    });
                    
                    circle.addEventListener('mouseout', function() {
                        document.getElementById('dataTooltip').style.opacity = '0';
                        this.setAttribute("r", "5");
                        this.setAttribute("fill", "rgba(255, 255, 255, 0.7)");
                    });
                }
            }
            
            // 時間指示器拖動功能
            let isDragging = false;
            
            timeIndicator.addEventListener('mousedown', function(e) {
                isDragging = true;
                document.body.style.cursor = 'grabbing';
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', function(e) {
                if (isDragging) {
                    const graph = document.querySelector('.graph-container');
                    const graphRect = graph.getBoundingClientRect();
                    const left = e.clientX - graphRect.left;
                    const percentage = Math.max(0, Math.min(100, (left / graphRect.width) * 100));
                    
                    timeIndicator.style.left = `${percentage}%`;
                    const currentMinute = Math.floor((percentage / 100) * 50);
                    
                    // 根據時間更新BPM和階段
                    let currentBpm, currentPhase;
                    if (currentMinute < 5) {
                        currentBpm = 62 + Math.floor(Math.random() * 5);
                        currentPhase = "開始階段";
                        
                        // 更新階段卡片激活狀態
                        phaseCards.forEach(card => card.classList.remove('active'));
                        document.getElementById('phase1').classList.add('active');
                        
                    } else if (currentMinute < 25) {
                        currentBpm = 68 + Math.floor(Math.random() * 5);
                        currentPhase = "探索階段";
                        
                        // 更新階段卡片激活狀態
                        phaseCards.forEach(card => card.classList.remove('active'));
                        document.getElementById('phase2').classList.add('active');
                        
                    } else if (currentMinute < 40) {
                        currentBpm = 82 + Math.floor(Math.random() * 8);
                        currentPhase = "高潮階段";
                        
                        // 更新階段卡片激活狀態
                        phaseCards.forEach(card => card.classList.remove('active'));
                        document.getElementById('phase3').classList.add('active');
                        
                    } else {
                        currentBpm = 72 + Math.floor(Math.random() * 5);
                        currentPhase = "結局階段";
                        
                        // 更新階段卡片激活狀態
                        phaseCards.forEach(card => card.classList.remove('active'));
                        document.getElementById('phase4').classList.add('active');
                    }
                    
                    timeIndicator.querySelector('.time-indicator-label').textContent = 
                        `${currentMinute}分 - ${currentBpm} BPM`;
                    
                    bpmValue.textContent = `${currentBpm} BPM`;
                    phaseValue.textContent = currentPhase;
                }
            });
            
            document.addEventListener('mouseup', function() {
                if (isDragging) {
                    isDragging = false;
                    document.body.style.cursor = 'default';
                }
            });
            
            // 導出按鈕功能
            document.getElementById('exportBtn').addEventListener('click', function() {
                alert('數據導出功能已觸發，報告將在3秒內生成。');
                setTimeout(() => {
                    alert('心跳軌跡數據已成功導出！');
                }, 2000);
            });
        });
    </script>
</body>
</html>